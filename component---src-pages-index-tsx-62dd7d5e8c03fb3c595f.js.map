{"version":3,"sources":["webpack:///./node_modules/isomorphic-base64/browser.js","webpack:///./src/hooks/covers.ts","webpack:///./src/components/Gallery/consts.ts","webpack:///./src/components/Gallery/Admin/index.tsx","webpack:///./src/components/Gallery/Admin/hooks.ts","webpack:///./src/components/Gallery/index.tsx","webpack:///./src/pages/index.tsx","webpack:///./src/components/FastImage/index.tsx","webpack:///./node_modules/gatsby/node_modules/core-js/modules/es6.array.find.js","webpack:///./node_modules/gatsby/node_modules/core-js/modules/es6.array.find-index.js"],"names":["exports","atob","self","bind","btoa","useCovers","allFile","edges","reduce","result","node","relativePath","split","src","childImageSharp","resize","width","height","color","dominantColor","json","require","products","gallery","map","id","find","product","b","b_","GalleryAdmin","covers","React","order","setOrder","undo","changeUndo","reorder","save","onChange","picked","setPicked","hovered","setHovered","dragStart","e","target","dataset","dragEnter","console","log","dragEnd","undefined","useDrag","from","to","fromIndex","findIndex","toIndex","item","splice","handleKb","key","ctrlKey","pop","window","addEventListener","removeEventListener","className","active","data-id","onDragEnter","onDragStart","onDragEnd","path","fetch","method","headers","body","JSON","stringify","credentials","Gallery","GalleryWithControls","isEdit","process","IndexPage","Layout","Image","svg","back","$export","$find","forced","Array","P","F","callbackfn","this","arguments","length","KEY"],"mappings":"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","file":"component---src-pages-index-tsx-62dd7d5e8c03fb3c595f.js","sourcesContent":["'use strict';\n\nrequire(\"core-js/modules/es6.function.bind\");\n\nexports.atob = self.atob.bind(self);\nexports.btoa = self.btoa.bind(self);","import { useStaticQuery, graphql } from \"gatsby\";\nimport { CoversQuery } from '../../gatsby-graphql';\n\ninterface Img {\n  src: string\n  color: string\n  width: number\n  height: number\n}\n\ninterface Cover {[path: string]: Img}\n\nexport const useCovers = () => {\n  const data = useStaticQuery<CoversQuery>(graphql`\n    query Covers {\n      allFile(filter: {relativePath: {regex: \"/cover\\\\./\"}}){\n        edges{\n          node{\n            relativePath\n            \n            childImageSharp{\n              resize(quality:95, height: 600){\n                src\n                width\n                height\n              }\n            }\n            dominantColor {\n              color\n            }\n          }\n        }\n      }\n    }\n  `);\n\n  return data.allFile.edges.reduce((result, { node }) => {\n    const path = node.relativePath.split('/')[0];\n    result[path] = {\n      src: node.childImageSharp?.resize?.src || '',\n      width: node.childImageSharp?.resize?.width || 0,\n      height: node.childImageSharp?.resize?.height || 0,\n      color: node.dominantColor?.color || 'white'\n    }\n    return result;\n  }, {} as Cover);\n}","import { ProductsJson } from \"../../types\";\n\nconst json: ProductsJson = require('../../products/products.json');\n\nexport type Product = ProductsJson['products'][number];\n\nexport const products = json.gallery.map(id => json.products.find(product => product.id === id)) as Product[]\n","import * as React from 'react'\nimport * as b_ from 'b_'\nimport { useCovers } from '../../../hooks/covers'\nimport { useDrag } from './hooks'\nimport {products, Product } from '../consts';\n\n\nimport './index.scss'\n\nconst b = b_.with('gallery-admin');\n\n\nconst GalleryAdmin: React.FC = () => {\n  const covers = useCovers()\n  const [order, setOrder] = React.useState(products)\n  const [undo, changeUndo] = React.useState<Product[][]>([\n    products,\n  ]);\n\n  const reorder = (order: Product[]) => {\n    setOrder(order);\n    save(order.map(product => product.id));\n  } \n\n  const onChange = (from: string, to: string) => {\n    const fromIndex = order.findIndex(({ id }) => from === id)\n    const toIndex = order.findIndex(({ id }) => to === id)\n\n    const result = [...order]\n    const [item] = result.splice(fromIndex, 1)\n    result.splice(toIndex, 0, item)\n    changeUndo([...undo, order])\n    reorder(result)\n  }\n\n  const { dragStart, dragEnter, dragEnd, picked, hovered } = useDrag(onChange)\n\n  const handleKb = (e: KeyboardEvent) => {\n    if (e.key === 'z' && e.ctrlKey) {\n      const result = undo.pop()\n      if (result) {\n        reorder(result);\n        changeUndo(undo);\n      }\n    }\n  }\n\n  React.useEffect(() => {\n    if (typeof window === 'undefined') {\n      return\n    }\n\n    window.addEventListener('keyup', handleKb)\n    return () => {\n      window.removeEventListener('keyup', handleKb)\n    }\n  })\n\n  return (\n    <section className={b()}>\n      {order.map(product => (\n        <>\n          <div\n            className={b('drop-zone', {\n              active: !!picked,\n              hovered: product.id === hovered && hovered !== picked,\n            })}\n            key={`${product.id}-drop-zone`}\n            data-id={product.id}\n            onDragEnter={dragEnter}\n          />\n          <img\n            key={product.id}\n            onDragStart={dragStart}\n            onDragEnd={dragEnd}\n            data-id={product.id}\n            src={covers[product.path].src}\n            className={b('item', { picked: picked === product.id })}\n          />\n        </>\n      ))}\n    </section>\n  )\n}\n\nexport default GalleryAdmin\n\n\nconst save = (order: string[]) => {\n  fetch(`http://localhost:3000/gallery`, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify(order),\n    credentials: 'include'\n  })\n}\n","import * as React from 'react';\n\nexport const useDrag = (onChange: ((from: string, to: string) => void)) => {\n  const [picked, setPicked] = React.useState<string | undefined>()\n  const [hovered, setHovered] = React.useState<string | undefined>()\n  const dragStart= (e: React.DragEvent<HTMLImageElement>) => {\n    // @ts-ignore\n    setPicked(e.target.dataset.id);\n  }\n  \n  const dragEnter = (e: React.DragEvent<HTMLDivElement>) => {\n    console.log('hovered', e.target)\n    // @ts-ignore\n    setHovered(e.target.dataset.id)\n  }\n  \n  const dragEnd = (e: React.DragEvent<HTMLDivElement>) => {\n    picked && hovered && onChange(picked, hovered)\n    setPicked(undefined)\n    setHovered(undefined)\n  }\n\n  return {\n    dragStart,\n    dragEnter,\n    dragEnd,\n    picked,\n    hovered,\n  }\n}","import * as React from 'react'\nimport { Link } from 'gatsby'\nimport * as b_ from 'b_'\nimport { useCovers } from '../../hooks/covers'\nimport { Image } from '../FastImage'\nimport GalleryAdmin from './Admin'\nimport { products } from './consts';\n\n\nimport './index.scss'\n\nconst b = b_.with('gallery')\n\nconst Gallery: React.FC = () => {\n  const covers = useCovers()\n\n  return (\n    <section className={b()}>\n      {products.map(product => (\n        <Link key={product.id} to={`/single/${product.path}`}>\n          <Image {...covers[product.path]} className={b('photo')} />\n        </Link>\n      ))}\n    </section>\n  )\n}\n\nconst isDev = process.env.NODE_ENV === 'development';\n\nconst GalleryWithControls: React.FC = () => {\n  const [isEdit, toggleEdit] = React.useState(false)\n\n  return (\n    <div className={b('wrap')}>\n      {isDev && (\n        <button \n        className={b('edit-btn', {active: isEdit})}\n          onClick={() => toggleEdit(v => !v)}\n        >\n          {!isEdit ? '✎' : '✓'}\n        </button>\n      )}\n      {isEdit ? <GalleryAdmin /> : <Gallery />}\n    </div>\n  )\n}\nexport default GalleryWithControls\n","import * as React from 'react'\nimport Layout from '../components/Layout'\nimport Gallery from '../components/Gallery'\n\nconst IndexPage = () => \n  <Layout>\n    <Gallery />\n  </Layout>\n\nexport default IndexPage\n","import * as React from 'react'\nimport * as b_ from 'b_';\nimport { btoa } from 'isomorphic-base64'\n\nimport './index.scss';\n\nconst b = b_.with('fast-image');\n\ninterface Props extends React.HTMLProps<HTMLImageElement> {\n  color: string\n}\n\nexport const Image: React.FC<Props> = ({\n  className,\n  color,\n  src,\n  width = 10,\n  height = 10\n}) => {\n  const svg = `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"${width}\" height=\"${height}\"><rect fill=\"${color}\" width=\"${width}\" height=\"${height}\"/></svg>`\n  const back = `data:image/svg+xml;base64,${btoa(svg)}`;\n\n  return (\n    <div className={`${b()} ${className || ''}`}>\n      <img src={back} className={b('back')}/>\n      <img src={src} className={b('image')}/>\n    </div>\n  )\n}\n","'use strict';\n// 22.1.3.8 Array.prototype.find(predicate, thisArg = undefined)\nvar $export = require('./_export');\nvar $find = require('./_array-methods')(5);\nvar KEY = 'find';\nvar forced = true;\n// Shouldn't skip holes\nif (KEY in []) Array(1)[KEY](function () { forced = false; });\n$export($export.P + $export.F * forced, 'Array', {\n  find: function find(callbackfn /* , that = undefined */) {\n    return $find(this, callbackfn, arguments.length > 1 ? arguments[1] : undefined);\n  }\n});\nrequire('./_add-to-unscopables')(KEY);\n","'use strict';\n// 22.1.3.9 Array.prototype.findIndex(predicate, thisArg = undefined)\nvar $export = require('./_export');\nvar $find = require('./_array-methods')(6);\nvar KEY = 'findIndex';\nvar forced = true;\n// Shouldn't skip holes\nif (KEY in []) Array(1)[KEY](function () { forced = false; });\n$export($export.P + $export.F * forced, 'Array', {\n  findIndex: function findIndex(callbackfn /* , that = undefined */) {\n    return $find(this, callbackfn, arguments.length > 1 ? arguments[1] : undefined);\n  }\n});\nrequire('./_add-to-unscopables')(KEY);\n"],"sourceRoot":""}