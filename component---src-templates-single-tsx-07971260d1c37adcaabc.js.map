{"version":3,"sources":["webpack:///./src/components/Single/components/MobileSlider/components/SliderView/index.tsx","webpack:///./src/components/Single/components/MobileSlider/index.tsx","webpack:///./src/components/Single/components/MobileZoom/index.tsx","webpack:///./src/components/Single/index.tsx","webpack:///./src/templates/single.tsx","webpack:///./src/components/Single/components/MobileSlider/static/unchecked.png","webpack:///./src/components/Single/components/MobileSlider/static/checked.png"],"names":["b","b_","SlideView","render","_this$props","this","props","width","touchPosition","index","current","isScrolling","pic","geo","onClick","position","react","className","smooth","style","left","backgroundImage","src","backgroundPositionX","positionX","backgroundPositionY","positionY","backgroundSize","size","React","Slider","_React$Component","_this","call","container","updateWidth","getBoundingClientRect","setState","onTouchMove","e","touchStartPosition","state","getTouchPosition","touches","pageX","onTouchStart","onTouchEnd","getCurrent","zoomed","inheritsLoose_default","_proto","prototype","_this2","slug","pics","_this$state","ref","el","height","map","i","components_SliderView","key","name","preview","_onClick","apply","arguments","toString","_","checked","unchecked","alt","x","length","_this$state2","distance","Math","round","newCurrent","abs","componentDidMount","window","addEventListener","document","componentWillUnmount","removeEventListener","Zoom","overlay","image","onClose","PinchZoom","body","classList","add","remove","console","log","Single","title","description","price","components_MobileSlider","components_MobileZoom","Object","assign","original","undefined","query","formatPics","data","slides","allFile","edges","_ref2","node","relativePath","split","slideProps","find","slide","id","childImageSharp","resize","SinglePage","_ref","_ref$pathContext","pathContext","src_components_Single","module","exports","__webpack_require__","p"],"mappings":"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","file":"component---src-templates-single-tsx-07971260d1c37adcaabc.js","sourcesContent":["import * as React from 'react'\nimport * as b_ from 'b_';\nimport {Image} from '../../../../types';\nimport './index.scss';\n\nconst b = b_.with('mobile-slider-slide');\n\ninterface Geo {\n  positionX?: number\n  positionY?: number\n  size?: number\n}\n\ninterface Props{\n  slug: string\n  pic: Image\n  name: string\n  geo: Geo\n  width: number\n  height: number\n  current: number\n  touchPosition: number;\n  isScrolling: boolean;\n  index: number;\n  onClick: () => void\n}\n\nclass SlideView extends React.Component<Props> {\n\n  render(){\n    \n    const {width, touchPosition, index, current, isScrolling, pic, geo, onClick} = this.props;\n\n    const position = (index - current) * width + touchPosition;\n\n    return (\n      <div\n        className={b('image-wrap', {smooth: !isScrolling})}\n        style={{\n          left: `${position}px`,\n        }}\n        onClick={onClick}\n      >\n        <div\n          className={b(\"image\")}\n          style={{\n            backgroundImage: `url(${pic.src})`,\n            backgroundPositionX: `${geo.positionX}px`,\n            backgroundPositionY: `${geo.positionY}px`,\n            backgroundSize: `${geo.size}%`\n          }}\n        />\n      </div>      \n    );\n  }\n}\n\nexport default SlideView;","import * as React from 'react'\nimport SlideView from './components/SliderView';\nimport * as b_ from 'b_';\nimport {Slide} from '../../types';\n\nimport './index.scss';\n\nimport * as unchecked from './static/unchecked.png';\nimport * as checked from './static/checked.png';\n\nconst ratio = 3/2;\n\ninterface Props {\n  slug: string\n  pics: Slide[];\n  onClick: (pic: Slide) => void\n}\n\ninterface State {\n  width: number;\n  current: number;\n  touchPosition: number;\n  isScrolling: boolean;\n  touchStartPosition: number;\n  zoomed: boolean\n}\n\nconst b = b_.with('mobile-slider');\n\nexport class Slider extends React.Component<Props, State> {\n  private container: HTMLDivElement | null = null;\n\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      width: 0,\n      current: 0,\n      touchPosition: 0,\n      touchStartPosition: 0,\n      isScrolling: true,\n      zoomed: false\n    };\n  }\n\n  render() {\n    const { slug, pics, onClick } = this.props;\n    const { current, width, touchPosition, isScrolling } = this.state;\n    \n    return (\n      <div\n        className={b()}\n        ref={el => (this.container = el)}\n      >\n        <div className={b('wrapper')} style={{height: `${width/ratio}px`}}>\n          {width &&\n            pics.map((pic, i) => (\n              <SlideView\n                key={i}\n                slug={slug}\n                name={pic.name}\n                pic={pic.preview}\n                geo={{\n                  positionX: pic.positionX,\n                  positionY: pic.positionY,\n                  size: pic.size\n                }}\n                index={i}\n                width={width}\n                height={width/ratio}\n                current={current}\n                touchPosition={touchPosition}\n                isScrolling={isScrolling}\n                onClick={() => onClick(pic)}\n              />\n            ))}\n        </div>\n        <div className={b('dots')}>\n          {pics.map((_, i) => (\n            <div\n              key={i}\n              className={b('dot')}\n              onClick={() => this.setState({current: i})}\n            >\n              <img src={i === this.state.current ? checked: unchecked} alt=\"o\"/>\n            </div>\n          ))}\n        </div>\n      </div>\n    );\n  }\n\n  private updateWidth = () => {\n    if (this.container) {\n      const { width } = this.container.getBoundingClientRect();\n      this.setState({ width });\n    }\n  };\n\n  private onTouchMove = (e: TouchEvent) => {\n    const { touchStartPosition } = this.state;\n    this.setState({\n      touchPosition: this.getTouchPosition(e.touches[0].pageX - touchStartPosition)\n    });\n  };\n\n  private onTouchStart = (e: TouchEvent) => {\n    this.setState({\n      touchStartPosition: e.touches[0].pageX,\n      isScrolling: true\n    });\n  };\n\n  private onTouchEnd = (e: TouchEvent) => {\n    this.setState({\n      current: this.getCurrent(),\n      touchPosition: 0,\n      isScrolling: false\n    });\n  };\n\n  private getTouchPosition(x: number) {\n    const { pics } = this.props;\n    const { current } = this.state;\n    // bounce\n    if (pics.length && ((current === 0 && x > 0) || (current === pics.length - 1 && x < 0))) {\n      return x / 10;\n    }\n    return x;\n  }\n\n  private getCurrent() {\n    const { pics } = this.props;\n    const { width, touchPosition, current } = this.state;\n\n    const distance = Math.round(touchPosition / (width / 2));\n    const newCurrent = current - (distance ? distance / Math.abs(distance) : 0);\n\n    if (pics.length) {\n      if (newCurrent < 0) {\n        return 0;\n      }\n      if (newCurrent > pics.length - 1) {\n        return pics.length - 1;\n      }\n    }\n    return newCurrent;\n  }\n\n  componentDidMount() {\n    this.updateWidth();\n    window.addEventListener('resize', this.updateWidth);\n    window.document.addEventListener('resize', this.updateWidth);\n\n    if (this.container) {\n      this.container.addEventListener('touchmove', this.onTouchMove);\n      this.container.addEventListener('touchstart', this.onTouchStart);\n      this.container.addEventListener('touchend', this.onTouchEnd);\n      this.container.addEventListener('touchcancel', this.onTouchEnd);\n    }\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('resize', this.updateWidth);\n    if (this.container) {\n      this.container.removeEventListener('touchmove', this.onTouchMove);\n      this.container.removeEventListener('touchstart', this.onTouchStart);\n      this.container.removeEventListener('touchend', this.onTouchEnd);\n      this.container.removeEventListener('touchcancel', this.onTouchEnd);\n    }\n  }\n}\n\nexport default Slider;","import * as React from 'react'\nimport * as b_ from 'b_';\nimport PinchZoom from 'pinch-zoom-js';\nimport { Image } from '../../types';\n\nimport './index.scss';\n\nconst b = b_.with('zoom');\n\ntype Props = Image & {\n  onClose: () => void;\n};\n\nclass Zoom extends React.Component<Props, {}> {\n\n  private overlay: HTMLDivElement | null = null;\n  private image: HTMLImageElement | null = null;\n\n  render(){\n    const {src, onClose} = this.props;\n    return (\n      <div\n        className={b()}\n        onClick={onClose}\n        ref={el => this.overlay = el}\n      >\n        <img\n          ref={el => el && new PinchZoom(el)}\n          src={src}\n        />\n      </div>);\n  }\n\n  componentDidMount(){\n    window.addEventListener('touchstart', this.onTouchStart);\n    window.document.body.classList.add('overflow-hidden');\n  }\n\n  componentWillUnmount(){\n    window.removeEventListener('touchstart', this.onTouchStart);\n    window.document.body.classList.remove('overflow-hidden');\n  }\n\n  private onTouchStart(e: TouchEvent){\n    console.log(e.touches);\n  }\n}\n\nexport default Zoom;","import * as React from 'react'\nimport * as b_ from 'b_'\nimport 'isomorphic-fetch';\nimport Slider from './components/MobileSlider';\nimport Zoom from './components/MobileZoom';\nimport {Slide} from './types';\n\nimport './index.scss';\n\nconst b = b_.with('single');\n\ninterface Props {\n  slug: string\n  pics: Slide[];\n  title?: string;\n  description?: string;\n  price?: number;\n}\n\ninterface State {\n  zoomed?: Slide\n}\n\nclass Single extends React.Component<Props, State> {\n\n  state: State ={};\n\n  render(){\n    const { slug, pics, title, description, price } = this.props;\n    const { zoomed } = this.state;\n\n    return (\n      <section className={b()}>\n        <Slider\n          pics={pics}\n          slug={slug}\n          onClick={pic => this.setState({zoomed: pic})}\n        />\n        {zoomed &&\n          <Zoom\n            {...zoomed.original}\n            onClose={() => this.setState({zoomed: undefined})}\n          />\n        }\n        <div className={b('title')}>{title}</div>\n        <div className={b('description')}>{description}</div>\n        {!!price && \n          <>\n            <div className={b('price')}>Цена: <span>{price} Р</span></div>\n            <button className={b('buy-btn')}>Купить</button>\n          </>\n        }\n      </section>);\n  }\n}\n\nexport default Single;","import * as React from 'react'\nimport { Link, graphql, StaticQuery } from 'gatsby'\nimport Layout from '../components/Layout'\nimport Single from '../components/Single'\nimport {AllFile} from '../types';\n\ntype Data = \n  AllFile<{\n    name: string;\n    relativePath: string\n    childImageSharp: {\n      resize: {\n        src: string;\n        width: number;\n        height: number;\n      }\n      original: {\n        src: string;\n        width: number;\n        height: number;\n      }\n    }\n  }>\n\ninterface Slide {\n  id: string\n  positionX: number\n  positionY: number\n  size: number\n}\n\ninterface Props {\n  pathContext: {\n    id: number\n    slug: string\n    title: string,\n    description?: string\n    price?: number\n    slides: Slide[]\n  }\n  data: Data\n}\n\nconst SinglePage = ({pathContext: {id, title, description, price, slug, slides}, data}: Props) => {\n  return (\n    <Single\n      slug={slug}\n      pics={formatPics(data, slides)}\n      title={title}\n      description={description}\n      price={price}\n    />);\n}\n\n\nexport const query = graphql`\n  query($slug: String!){\n    allFile(filter: {relativeDirectory: {eq: $slug }}){\n      edges{\n        node{\n          name\n          relativePath\n          childImageSharp{\n            resize(height: 500, quality: 95){\n              src\n              width\n              height\n            }\n\n            original{\n              src\n              width\n              height\n            }\n          }\n        }\n      }\n    }\n  }\n`;\n\nconst formatPics = (data: Data, slides: Slide[]) => data.allFile.edges.map(({node}) => {\n  const name = node.relativePath.split('/')[1];\n  const slideProps = slides.find(slide => slide.id === name);\n\n  return {\n    name,\n    preview: node.childImageSharp.resize,\n    original: node.childImageSharp.original,\n    ...slideProps\n  }\n});\n\nexport default SinglePage;","module.exports = __webpack_public_path__ + \"static/unchecked-295110b012c345d99b76fe0d7ee1f269.png\";","module.exports = __webpack_public_path__ + \"static/checked-8e4a99812894e754cd4d63d134c7e64a.png\";"],"sourceRoot":""}